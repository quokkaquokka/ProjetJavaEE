<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Employee Details Page</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@beta/dist/js.cookie.min.js"></script>
    </head>
    <body>
        <script>
            function setList(data) {
                data.forEach(function(item) {
                    $("#employees").append('<tr>')
                    $("#employees").append('<td>' + '<input type="radio" name="ids" id="ids" value="' + item.objectID + '" checked>' + '</td>')
                    $("#employees").append('<td>' + item.name + '</td>')
                    $("#employees").append('<td>' + item.firstname + '</td>')
                    $("#employees").append('<td>' + item.telhome + '</td>')
                    $("#employees").append('<td>' + item.telmob + '</td>')
                    $("#employees").append('<td>' + item.telpro + '</td>')
                    $("#employees").append('<td>' + item.adress +  '</td>')
                    $("#employees").append('<td>' + item.postalcode + '</td>')
                    $("#employees").append('<td>' + item.city + '</td>')
                    $("#employees").append('<td>' + item.email + '</td>')
                    $("#employees").append("</tr>")
                })
            }
        </script>
        <script>
            $.ajax({
              url: "http://localhost:8080/se.abdmeziem-moutte.part3/api/v1/employees/getAll"
            })
            .done(function( data ) {
                  var employees = data.hits
                  console.log('Employees : ' , employees)
                  setList(employees)
            })
        </script>
        <form  name='myform'>
            <table class="table">
                <thead>
                    <tr>
                        <th>Details</th>
                        <th>Name</th>
                        <th>Firstname</th>
                        <th>Phone Home</th>
                        <th>Phone Mobile</th> 
                        <th>Phone Pro</th>
                        <th>Address</th>
                        <th>Postal code</th>
                        <th>City</th>
                        <th>email</th>
                    </tr>
                </thead>
                    <tbody id="employees">
                    </tbody>
            </table>
            <div class="ml-2" id="divDelete" style="display:inline-block">
                <script>
                    console.log('Cookie role', Cookies.get('role') )
                    if(Cookies.get('role') === 'admin')
                        $("#divDelete").append('<button type="button" id="btnDelete" name="delete" class="btn btn-danger">Delete</button>')  
                    $("#btnDelete").click(function(ev){
                        console.log('DELETE')
                        var form = document.querySelector("form");
                        var data = new FormData(form);
                        var output = "";
                        for (const entry of data) {
                            output = entry[1];
                        };
                        console.log("ids ", output);
                         
                        var request = $.ajax({
                          url: "http://localhost:8080/se.abdmeziem-moutte.part3/api/v1/employees/delete/{"+ output +"}",
                          contentType: "application/json"
                        })

                        request.done(function (reponse) {
                            console.log('Employees : ' , reponse);
                            window.location.reload();
                              
                        });
                        request.fail(function (jqXHR, textStatus) {
                           console.log(textStatus, jqXHR);
                        });
                     })
                </script>
                <button type="submit" id="btnDetails" class="btn btn-info">DÃ©tails</button>
                <script>
                    $("#btnDetails").click(function(ev){
                        console.log("DETAILSSSS")
                        var form = document.querySelector("form");
                        var data = new FormData(form);
                        var output = "";
                        for (const entry of data) {
                            output = entry[0] + "=" + entry[1] + "\r";
                        };
                        console.log("ids = ", output);

                        event.preventDefault();

                        window.location.href = "/se.abdmeziem-moutte.part3/detailsemployees.html? " + output
                      })
                </script>
                
                <div class="ml-2" id="divAdd" style="display:inline-block">
                <script>
                    if(Cookies.get('role') === 'admin')
                        $("#divAdd").append(' <button type="button" id="btnAdd" name="add" class="btn btn-primary">Add</button>')
                     $("#btnAdd").click(function(ev){
                       window.location.href = "/se.abdmeziem-moutte.part3/addEmployees.html"
                     })
                </script> 
        </form>
    </body>
</html>
